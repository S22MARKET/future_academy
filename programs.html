<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>البرامج الدراسية - أكاديمية جيل المستقبل</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f8fafc; }
        .active-link { background-color: #eff6ff; color: #3b82f6; font-weight: 700; border-right: 4px solid #3b82f6; }
        .sidebar-link:hover { background-color: #eff6ff; color: #3b82f6; transform: translateX(-4px); }
        .skeleton-line { background-color: #e5e7eb; border-radius: 0.25rem; animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 50% { opacity: .5; } }
        .filter-btn.active { background-color: #3b82f6; color: white; border-color: #3b82f6; }
    </style>
</head>
<body class="bg-slate-50">
    <div class="flex flex-col min-h-screen">
        <div class="flex flex-1">
            <aside id="sidebar" class="fixed top-0 right-0 h-full bg-white shadow-lg w-64 transform transition-transform translate-x-full lg:translate-x-0 lg:static z-50">
                <div class="p-5 border-b text-center"><a href="index.html" class="text-2xl font-extrabold text-gray-800">جيل <span class="text-blue-600">المستقبل</span></a></div>
                <nav class="flex flex-col p-4 space-y-2">
                    <a href="index.html" class="flex items-center gap-4 p-3 rounded-lg sidebar-link"><i class="fas fa-home fa-fw text-xl w-6 text-center"></i><span>الرئيسية</span></a>
                    <a href="programs.html" class="flex items-center gap-4 p-3 rounded-lg sidebar-link active-link"><i class="fas fa-book-open fa-fw text-xl w-6 text-center"></i><span>البرامج الدراسية</span></a>
                    <a href="salles.html" class="flex items-center gap-4 p-3 rounded-lg sidebar-link"><i class="fas fa-school fa-fw text-xl w-6 text-center"></i><span>القاعات</span></a>
                    <a href="schedule.html" class="flex items-center gap-4 p-3 rounded-lg sidebar-link"><i class="fas fa-calendar-alt fa-fw text-xl w-6 text-center"></i><span>الجدول الزمني</span></a>
                    <a href="contact.html" class="flex items-center gap-4 p-3 rounded-lg sidebar-link"><i class="fas fa-envelope fa-fw text-xl w-6 text-center"></i><span>تواصل معنا</span></a>
                    <a href="dashboard.html" class="flex items-center gap-4 p-3 rounded-lg sidebar-link mt-8 border-t pt-4"><i class="fas fa-user-shield fa-fw text-xl w-6 text-center"></i><span>دخول الإدارة</span></a>
                </nav>
            </aside>

            <div class="flex-1 min-w-0">
                <header class="lg:hidden bg-white shadow-md p-4 flex justify-between items-center sticky top-0 z-40"><a href="index.html" class="text-xl font-extrabold text-gray-800">جيل <span class="text-blue-600">المستقبل</span></a><button id="menu-btn" class="text-2xl text-gray-600"><i class="fas fa-bars"></i></button></header>
                <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-16">
                    <h1 class="text-4xl font-bold text-center mb-4 text-slate-800">برامجنا الدراسية</h1>
                    <p class="text-center text-lg text-slate-500 mb-12 max-w-2xl mx-auto">اكتشف مجموعتنا المتنوعة من البرامج، وقم بالتصفية حسب الفئة التي تناسبك.</p>
                    
                    <div id="filter-container" class="flex flex-wrap justify-center gap-2 mb-10"></div>
                    <div id="programs-container" class="space-y-8 max-w-4xl mx-auto"></div>
                </main>
            </div>
            <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden lg:hidden"></div>
        </div>
        <footer class="bg-white border-t mt-auto"><div class="max-w-7xl mx-auto py-6 px-4 text-center text-gray-500"><p>&copy; 2025 أكاديمية جيل المستقبل. جميع الحقوق محفوظة.</p></div></footer>
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        const firebaseConfig = { apiKey: "AIzaSyB-VyUd5FUMb0KCUROhQRqoyOL1V7Noguk", authDomain: "akadimiat-jyl-almustaqbal.firebaseapp.com", projectId: "akadimiat-jyl-almustaqbal", storageBucket: "akadimiat-jyl-almustaqbal.appspot.com", messagingSenderId: "495523964077", appId: "1:495523964077:web:c73b443dd98733ab0a9224" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let allPrograms = [];

        document.addEventListener('DOMContentLoaded', () => {
            const sidebar = document.getElementById('sidebar'), overlay = document.getElementById('overlay'), menuBtn = document.getElementById('menu-btn');
            const toggleSidebar = () => { sidebar.classList.toggle('translate-x-full'); overlay.classList.toggle('hidden'); };
            if (menuBtn) menuBtn.addEventListener('click', toggleSidebar);
            if (overlay) overlay.addEventListener('click', toggleSidebar);
            loadData();
        });

        function getSkeletonHTML() { return `<div class="bg-white p-6 rounded-lg shadow-md border-r-4 border-gray-200 space-y-4"><div class="skeleton-line h-6 w-3/4"></div><div class="space-y-2"><div class="skeleton-line h-4 w-full"></div><div class="skeleton-line h-4 w-5/6"></div></div><div class="border-t pt-4 grid grid-cols-1 sm:grid-cols-2 gap-4"><div class="skeleton-line h-5 w-1/2"></div><div class="skeleton-line h-5 w-1/2"></div><div class="skeleton-line h-5 w-1/2"></div><div class="skeleton-line h-5 w-1/2"></div></div></div>`.repeat(3); }

        async function loadData() {
            document.getElementById('programs-container').innerHTML = getSkeletonHTML();
            
            try {
                const programsQuery = query(collection(db, "programs"), orderBy("createdAt", "desc"));
                const categoriesQuery = query(collection(db, "programCategories"), orderBy("name"));

                const [programsSnapshot, categoriesSnapshot] = await Promise.all([
                    getDocs(programsQuery),
                    getDocs(categoriesQuery)
                ]);

                if (programsSnapshot.empty) {
                    document.getElementById('programs-container').innerHTML = `<div class="text-center bg-white p-10 rounded-lg shadow-md"><i class="fas fa-info-circle text-5xl text-blue-400 mb-4"></i><h2 class="text-2xl font-bold text-slate-700">لا توجد برامج متاحة حالياً</h2></div>`;
                    document.getElementById('filter-container').innerHTML = '';
                    return;
                }

                allPrograms = programsSnapshot.docs.map(doc => doc.data());
                const categories = categoriesSnapshot.docs.map(doc => doc.data().name);

                setupFilters(categories);
                renderPrograms('all');
            } catch (error) {
                console.error("Error loading data from Firebase: ", error);
                document.getElementById('programs-container').innerHTML = `<div class="text-center bg-red-100 text-red-700 p-10 rounded-lg shadow-md"><i class="fas fa-exclamation-triangle text-5xl text-red-500 mb-4"></i><h2 class="text-2xl font-bold">حدث خطأ في الاتصال بقاعدة البيانات</h2><p class="mt-2">يرجى المحاولة مرة أخرى لاحقاً أو التأكد من إعدادات Firebase.</p></div>`;
            }
        }

        function setupFilters(categories) {
            const filterContainer = document.getElementById('filter-container');
            if (categories.length === 0) { filterContainer.innerHTML = ''; return; }
            
            const filterButtons = ['all', ...categories];
            filterContainer.innerHTML = filterButtons.map(category => `<button class="filter-btn px-4 py-2 rounded-full font-semibold transition-colors bg-white text-slate-700 border hover:bg-blue-100 ${category === 'all' ? 'active' : ''}" data-category="${category}">${category === 'all' ? 'الكل' : category}</button>`).join('');
            filterContainer.querySelectorAll('.filter-btn').forEach(button => {
                button.addEventListener('click', () => {
                    filterContainer.querySelector('.filter-btn.active')?.classList.remove('active');
                    button.classList.add('active');
                    renderPrograms(button.dataset.category);
                });
            });
        }

        function renderPrograms(categoryFilter) {
            const container = document.getElementById('programs-container');
            const filteredPrograms = categoryFilter === 'all' ? allPrograms : allPrograms.filter(p => p.category === categoryFilter);

            if (filteredPrograms.length === 0) {
                 container.innerHTML = `<div class="text-center bg-white p-10 rounded-lg shadow-md"><i class="fas fa-search text-5xl text-slate-400 mb-4"></i><h2 class="text-2xl font-bold text-slate-700">لا توجد برامج تطابق هذا الفلتر</h2></div>`;
                 return;
            }

            container.innerHTML = filteredPrograms.map(program => {
                let scheduleIcon = 'fa-calendar-day';
                let scheduleText = 'غير محدد';
                if (program.schedule) {
                    if (program.schedule.type === 'weekly' && program.schedule.days?.length > 0) {
                        scheduleIcon = 'fa-calendar-week';
                        scheduleText = `أسبوعياً: ${program.schedule.days.join(', ')}`;
                    } else if (program.schedule.type === 'single_date' && program.schedule.date) {
                        scheduleIcon = 'fa-calendar-alt';
                        scheduleText = `بتاريخ: ${program.schedule.date}`;
                    }
                }

                return `
                <div class="bg-white p-6 rounded-lg shadow-md transition-all duration-300 hover:shadow-xl hover:scale-[1.02] border-r-4 border-blue-600">
                    <div class="flex justify-between items-start mb-3">
                        <h2 class="text-2xl font-bold text-blue-700">${program.title}</h2>
                        ${program.category ? `<span class="text-xs font-bold text-blue-600 bg-blue-100 px-3 py-1 rounded-full whitespace-nowrap">${program.category}</span>` : ''}
                    </div>
                    <p class="text-gray-600 mb-5 min-h-[40px]">${program.description || ''}</p>
                    <div class="border-t pt-4 grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4 text-md text-gray-700">
                        <div class="flex items-center gap-3"><i class="fas fa-chalkboard-teacher text-blue-500 fa-fw text-lg"></i><strong>الأستاذ:</strong> <span>${program.teacher || ''}</span></div>
                        <div class="flex items-center gap-3"><i class="fas fa-layer-group text-blue-500 fa-fw text-lg"></i><strong>المستوى:</strong> <span>${program.level || ''}</span></div>
                        <div class="flex items-center gap-3"><i class="fas ${scheduleIcon} text-blue-500 fa-fw text-lg"></i><strong>الجدولة:</strong> <span>${scheduleText}</span></div>
                        <div class="flex items-center gap-3"><i class="fas fa-clock text-blue-500 fa-fw text-lg"></i><strong>التوقيت:</strong> <span>${program.startTime || ''} - ${program.endTime || ''}</span></div>
                        <div class="flex items-center gap-3 sm:col-span-2"><i class="fas fa-school text-blue-500 fa-fw text-lg"></i><strong>القاعة:</strong> <span>${program.hall || 'غير محددة'}</span></div>
                    </div>
                </div>`
            }).join('');
        }
    </script>
</body>
</html>

